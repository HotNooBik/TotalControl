{% extends "main/base.html" %}
{% block content %}
  <h1>Загрузка фотографии блюда</h1>

  {% if error %}
    <div class="alert alert-warning">{{ error }}</div>
  {% endif %}

  {# Шаг 2: редактирование найденных продуктов #}
  {% if formset %}
    <form method="post">
      {% csrf_token %}
      {{ formset.management_form }}
      <table>
        <thead>
          <tr>
            <th>Название</th>
            <th>Количество</th>
            <th>Калории</th>
            <th>Белки</th>
            <th>Жиры</th>
            <th>Углеводы</th>
            <th>Прием пищи</th>
          </tr>
        </thead>
        <tbody>
          {% for form in formset %}
            <tr>
              {% for field in form.visible_fields %}
                <td>
                  {{ field.errors }}
                  {{ field }}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit">Сохранить в дневник</button>
    </form>

  {# Шаг 1: загрузка изображения #}
  {% else %}
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {{ upload_form.image.label_tag }}
      {{ upload_form.image }}
      <button type="submit">Загрузить</button>
    </form>
  {% endif %}

{% endblock %}
